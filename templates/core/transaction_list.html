{% extends "core/base.html" %}
{% block content %}
<h1 class="h4 mb-3">Записи ДДС</h1>

<form class="row g-2 mb-3">
  <div class="col-md-2">
    <label class="form-label">С даты</label>
    <input name="date_from" type="date" class="form-control" value="{{ f.date_from }}">
  </div>
  <div class="col-md-2">
    <label class="form-label">По дату</label>
    <input name="date_to" type="date" class="form-control" value="{{ f.date_to }}">
  </div>
  <div class="col-md-2">
    <label class="form-label">Статус</label>
    <select name="status" class="form-select">
      <option value="">—</option>
      {% for s in statuses %}
      <option value="{{s.id}}" {% if f.status|add:'' == s.id|stringformat:"s" %}selected{% endif %}>{{s.name}}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <label class="form-label">Тип</label>
    <select name="type" class="form-select" id="filter-type">
      <option value="">—</option>
      {% for t in types %}
      <option value="{{t.id}}" {% if f.type|add:'' == t.id|stringformat:"s" %}selected{% endif %}>{{t.name}}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <label class="form-label">Категория</label>
    <select name="category" class="form-select" id="filter-category" data-sub-url="/dds/ajax/subcategories/">
      <option value="">—</option>
      {% for c in categories %}
      <option value="{{c.id}}" {% if f.category|add:'' == c.id|stringformat:"s" %}selected{% endif %} data-type="{{c.type_id}}">{{c.name}}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <label class="form-label">Подкатегория</label>
    <select name="subcategory" class="form-select" id="filter-subcategory">
      <option value="">—</option>
      {% for sc in subcategories %}
      <option value="{{sc.id}}" {% if f.subcategory|add:'' == sc.id|stringformat:"s" %}selected{% endif %} data-category="{{sc.category_id}}">{{sc.name}}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-12">
    <button class="btn btn-primary">Фильтровать</button>
    <a class="btn btn-outline-secondary" href="/dds/">Сбросить</a>
  </div>
</form>

<div class="table-responsive bg-white shadow-sm rounded">
<table class="table table-sm align-middle mb-0">
  <thead class="table-light">
    <tr>
      <th>Дата</th><th>Статус</th><th>Тип</th><th>Категория</th><th>Подкатегория</th><th class="text-end">Сумма, ₽</th><th>Комментарий</th><th></th>
    </tr>
  </thead>
  <tbody>
    {% for it in items %}
    <tr>
      <td>{{ it.date }}</td>
      <td>{{ it.status.name }}</td>
      <td>{{ it.type.name }}</td>
      <td>{{ it.category.name }}</td>
      <td>{{ it.subcategory.name }}</td>
      <td class="text-end">{{ it.amount }}</td>
      <td class="text-truncate" style="max-width:260px">{{ it.comment }}</td>
      <td class="text-nowrap">
        <a href="/dds/{{it.id}}/edit/" class="btn btn-sm btn-outline-primary">Изменить</a>
        <a href="/dds/{{it.id}}/delete/" class="btn btn-sm btn-outline-danger">Удалить</a>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="8" class="text-center py-4 text-muted">Нет записей</td></tr>
    {% endfor %}
  </tbody>
</table>
</div>

<nav class="mt-3">
  {% if is_paginated %}
    <ul class="pagination">
      {% if page_obj.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{page_obj.previous_page_number}}">Назад</a></li>
      {% endif %}
      <li class="page-item disabled"><span class="page-link">Стр. {{page_obj.number}} из {{paginator.num_pages}}</span></li>
      {% if page_obj.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{page_obj.next_page_number}}">Вперёд</a></li>
      {% endif %}
    </ul>
  {% endif %}
</nav>
{% endblock %}
